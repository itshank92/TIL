04

오라클 PDB 서버에 접속하기



(cf_ 오라클 설치 완료시 나오는 화면)

![image-20210726135835146]([Oracle_DB] 기초(04-).assets/image-20210726135835146.png)





### 1. 데이터 베이스 종류

#### CDB(컨테이너 데이터 베이스)

* 설치된 오라클 데이터 베이스 그 자체를 지칭함



#### PDB(Pluggable 데이터 베이스)

* CDB에 꼿아서 사용 가능한 독립된 데이터 베이스
* CREATE 명령을 통해서 만들 수 있음



#### CDB와 PDB는 완전히 독립적인 데이터 베이스

* 즉, 각 DB의 사용자 역시 완전 독립적이다.
* 초기의 관리자 계정은 아이디는 "sys"이고  비밀번호는 초기 설정 비밀번호로 두 DB 모두 동일하지만, 두 관리자 계정은 각각 DB의 데이터에 독립적으로 저장된 별개의 존재다.  



#### (기타) Seed DB

* PDB를 만들기 위한 템플릿 DB

  



### 2. PDB에 접속하기 ( SQL Developer를 사용해서 접속하기)



#### 0) 기본 내용

* CDB의 경우 SID를 통해서 접속 (SID: xe)
* PDB의 경우 서비스 이름을 통해서 접속 (서비스 이름: xepdb1)



#### 1) 데이터 베이스에서 PDB 목록 확인하기

* cmd창에서 sqlplus를 사용해서 DB에 접속

  ```
  sqlplus sys as sysdba
  ```

* sys 계정의 암호 입력  



#### 2) PDB 목록을 확인

```sql
SELECT NAME FROM V$PDBS;
```

  



### 3. 데이터 베이스를 외부에서 접속하기

#### 0) 기본 내용

* DB의 기본(by default)설정은 로컬에서만 접근 가능하다.
  
  * [ 로컬에서만 접근가능 ] 속성의 기본 값은 `TRUE`다.
* [ 로컬에서만 접근가능 ] 이라는 속성값을 `FALSE`로 바꾸면 외부에서도 접근 가능하다.

  

#### 1) CMD에서 SQL 접속(관리자 계정)

```
sqlplus sys as sysdba
```

  

#### 2) 로컬에서만 접속가능 속성값을 FALSE로 바꿈

```sql
EXEC DBMS_XDB.SETLISTENERLOCALACCESS(FALSE);
```

* 로컬에서만 접근 가능 속성 값인 `SETLISTENERLOCALACCESS` 을 `FALSE`로 바꾸면 외부에서도 접근 가능해진다.  

* 이렇게 설정을 하면 외부에서 해당 DB에 접근하려 할 때, 호스트 이름에 해당 DB의 IP 주소를 입력함으로서 접속 가능하다. 
  * 물론 해당 DB가 설치된 컴퓨터에서 DB가 사용하는 포트가 방화벽으로 설정되어 있으면 안된다.

  

---

05

수업에서 사용할 **<u>테이블 스페이스</u>**와 **<u>사용자</u>** 생성하기



### 1. 기본 계정의 종류 (by default)

#### 1) 관리자 계정

* `SYSTEM` ('시스템계정'): 일반적인 관리자 권한 
* `SYS` ('시스계정'): 좀 더 강력한 권한 (SYSDBA)

#### 2) (샘플 데이터를 사용 가능한) 샘플 사용자 계정

* 우리 과정의 경우 샘플 데이터나 샘플 사용자 계정을 사용하지 않는다.





### 2. <u>데이터베이스</u>와  <u>데이터 파일</u>  그리고  <u>테이블 스페이스</u>

#### **[ 데이터 베이스 ]**

* 여러 데이터를 가지고 있는 공간
* 여러 데이터는 각각 독립된 테이블로 저장되어 있다. 
  * 각 테이블을 구성하는 데이터가 실제 물리적인 저장공간에 모여서 저장되어 있는지, 아니면 분산되어 저장되어 있는지는 DBMS에 따라 다르다.  

  

#### **[ 데이터 파일 ]**

* 각 테이블은 데이터 파일 형태로 존재한다.

  

#### **[ 테이블 스페이스 ]**

* 모든 테이블들이 존재하는 공간을 테이블 스페이스라고 부른다.
* 즉 `데이터 베이스` **⊃** `테이블 스페이스` **⊃** `데이터 파일` 구조가 된다. 
  * 이러한 구조를 **데이터 베이스 구조** 혹은 **스키마(Schema)**라고 부른다. 

  

  

### 3. PDB와 CDB에서 시스템계정 정보는 어디에 있을까?

#### [ PDB의 경우 ]

```
C:\APP\NEWLEC\PRODUCT\18.0.0\ORADATA\XE\XEPDB1\SYSTEM01.DBF
```

* 우리 과정은 PDB를 사용해서 데이터 베이스를 학습할 것이기 때문에 PDB에 접속을 한다.



#### [ CDB의 경우 ]

```
C:\APP\NEWLEC\PRODUCT\18.0.0\ORADATA\XE\SYSTEM01.DBF
```





### 4. 테이블 스페이스 만들기

#### 0) 사전 이해

* 이번에 할 작업은 기존의 DB를 사용하는 것이 아닌 DB에 테이블 스페이스를 만드는 작업이기에 **<u>DBA권한</u>**을 가지고 접속해야 한다. 



#### 1) DBA로 DB 접근

* SQL Developer > 사용할 [ PDB ] 클릭 >  [ 보기 ]  > [ DBA]  > [접속] 블록에서 [ + ] 버튼 > 접속하려는 [ PDB ] 클릭 후 확인  



#### 2) 테이블 스페이스 디렉토리 접근

* [ 접속 ] 블록 > [ PDB ] 하위에 있는 [ 저장 영역 ] > [ 테이블 스페이스 ]

* 이 과정에서 로그인 창이 뜨면 sys 계정으로 접속한다.  



#### 3) 테이블 스페이스 새로 만들기

* 테이블 스페이스 오른쪽 클릭 > [ 새로 만들기 ] 

* 테이블 스페이스 이름은 임의로 설정 ("NEWLEC_TABLESPACE")
* 테이블 스페이스에 속하는 파일(테이블 파일)은 [ + ] 버튼을 통해 추가가 가능하다.  



#### 4) 테이블 스페이스 디렉토리 설정

* [ 디렉토리 ]는 해당 테이블 스페이스의 파일들을 어디에 저장할 것인지 경로를 설정하는 곳이다.

* 적당한 디렉토리를 설정한다. 



#### 5) 테이블 스페이스가 관리할 파일들의 최대 크기 설정

* [ 파일 크기 ]의 경우 해당 파일의 최대 크기를 설정하는 것이다. 

![image-20210726150711640]([Oracle_DB] 기초(04-).assets/image-20210726150711640.png)

* 크기와 단위를 설정할 수 있다. (ex_ 500, MB)
* 아래에 있는 [ 자동 확장 설정 ] 옵션은 파일의 크기가 500MB를 초과하는 경우 최대한도를 얼마나 더 늘릴지 정해놓는 것이다. 
  * [다음 크기] : 얼마나 더 늘릴지 정해놓는 옵션
  * [최대 크기] : 자동 확장 설정으로 늘릴 수 있는 최대 파일 크기



#### 6) 생성 완료 후 확인

* 이렇게 생성하게 되면 [ PDB]  >  [ 저장공간 ]  >  [ 테이블 스페이스 ] 디렉토리에 방금 만든 테이블 스페이스가 나타나게 된다. 

  

  





### 5. 트랜잭션 데이터를 저장할 또 다른 테이블 스페이스 만들기

#### 0) 설명

* 데이터 중에는 영구적으로 저장하려는 데이터도 있지만, 임시적으로 사용할 데이터도 존재한다.

* 그러한 데이터 역시 테이블 형태로 존재하는데 그러한 테이블들은 영구 데이터 테이블과는 다른 테이블 스페이스를 사용해서 저장한다. 

* 이를 위한 새로운 테이블 스페이스를 만들어준다.



#### 1) 테이블 스페이스 생성

* 다음과 같이 작성한다. 
  * 이름: NEWLEC_LOGSPACE
  * 테이블스페이스 유형: 임시
  * 이름: LOG_FILE1
  * 디렉토리: 테이블 파일 저장할 로컬 공간 임의로 지정

* 파일크기의 경우 작은 경우 트랜잭션이 처리되다가 종료되기 때문에 그런 일을 방지하기 위해서 적당히 큰 크기로 설정해야 한다.





#### 2) 테이블 스페이스 이름의 의미

`NEWLEC_TABLESPACE`, `NEWLEC_LOGSPACE` 형식으로 테이블 스페이스가 명명되었다. 

이는 `NEWLEC` 이라는 사용자 계정이 사용하는 테이블들이 저장된 공간이라는 뜻이다. 

* 물론 강제성이 있는 것은 아니고 관습적으로 이렇게 작성되는 것이다.

테이블 스페이스를 만들었으니 이제는 이 테이블을 사용하는 사용자 계정인 NEWLEC을 생성해보자.





### 6. 사용자 계정 만들기

#### 0) 사용자 계정 디렉토리에서 새로 만들기 

* [ PDB ] > [ 보안 ] > [ 사용자 ]를 마우스 오른쪽 버튼 누르고 [ 새로 만들기 ] 클릭  



* [사용자 탭]

  * 사용자 이름에는 NEWLEC

  * 기본 테이블 스페이스

    ▷ 영구 데이터를 저장할 테이블들이 존재하는 공간(우리의 경우 NEWLEC_TABLESPACE가 해당)

  * 임시 테이블 스페이스

    ▷ 임시 데이터를 저장할 테이블들이 존재하는 공간(우리의 경우 NEWLEC_LOGSPACE가 해당)



* [ 시스템 권한 탭 ]
  * 여기는 해당 사용자에 부여할 권한을 설정하는 공간이다.
  * 여기서는 [ 모두 관리자 ] 를 기본으로 클릭하고 그 중 `SYSKM`, `SYSOPER`, `SYSRAC`만 체크 해제해준다. 

  

#### 1) 이제 새로 만든 계정을 가지고 접속해보자.

* 기존에 DBA로 접속한 블록을 닫는다. 
* [접속] 탭에서 [ + ] 버튼을 누르고 새로운 계정정보로 PDB에 접속한다. 
  * 이 때, 방금 만든 계정(NEWLEC) 정보를 사용해서 접속을 한다. 
  * [ 롤 ]은 [ 기본값 ]으로 설정한다. 
  * 접속정보는 기존에 입력한 PDB 접속 정보와 동일하다.



#### 2) 이렇게 접속한 PDB에는 테이블이 아무것도 없다.

* 이유 ▶ 우리는 해당 계정에게 할당된 테이블 스페이스만 만들었지 그 안에 테이블은 만들지 않았다. 
* 다음 시간에는 테이블 생성을 배워본다. 