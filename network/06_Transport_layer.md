## 전송 계층

#### 전송 계층의 존재의의

* 물리, 데이터, 네트워크 계층에서는 데이터 전달에만 신경을 썼다면, 전송계층에서는 해당 전달의 신뢰성, 완성도를 관리해주는 역할을 수행한다.
* 완전한 데이터가 전송되는지, 잘못된 주소로 전송되는 것은 아닌지 확인하여 이를 올바르게 조정해주는 기능을 담당한다. 
* 또한 전송된 데이터가 어떤 어플리케이션으로 가야하는지 세부 목적지를 식별해주는 기능도 수행한다.



> ★ 요약: 전송계층은 **데이터 전송의 신뢰성 보장**과 **최종 목적지 어플리케이션 식별** 기능을 수행한다. 

​     

#### 멀티플랙싱(Multiplexing)과 디 멀티플랙싱(Demultiplexing)

* 전송계층의 기본 기능 중 데이터가 올바른 어플리케이션으로 전달되는 기능과 관련된 용어다. 

- **멀티플랙싱(Multiplexing)**
  
  * **여러 개의 application의 통신 데이터를 하나의 회선을 통해 전달**하는 것
  * 예를 들면 여러 app의 message들은 결국 하나의 physical layer을 통해 전달된다.
  
- **디 멀티플랙싱(Demultiplexing)**
  
  - 수신 컴퓨터에서 **하나의 회선을 통해 받은 정보를 다시 application 별로 나눠서 전달** 받는 것.
  
* 멀티플랙싱과 디 멀티플랙싱을 가능하게 하는 요인들

  (1) 전송계층의 segment들은 송신application과 **수신application의 port번호** 정보가 포함 된다. 

  - 서로 다른 application은 서로 다른 port 번호를 할당 받는다.

  (2)  TCP에서는 전송마다 Connection이 형성되기에 송신자와 수신자가 명확히 정해지게 된다.

  * 하나의 application에 여러 개의 다른 process가 생성되는 경우 같은 port 번호를 가지게 되는 
    경우가 있다.
  * 이 경우도 독립적인 통신이 가능한 이유는 바로 **각각의 프로세스는 각각의 connection이 형성**되기에 하나의 application의 서로 다른 프로세스들이 설령 같은 port번호를 가져도, 통신과정에서 혼선은 발생하지 않는다.  

| [socket]                                                     |
| ------------------------------------------------------------ |
| ▶ application layer에서 (송신) application이 어떤 (수신)application과 통신하려고 하는지에 대한 포트 정보를 결정해서 전송계층에서 전달할 때 **socket**이라는 API 집합을 사용해 이뤄진다.<br />▶socket은 application에서 전송하려는 데이터를 전송계층에 보내기 위한 API(명령어)들의 집합이다.<br />▶ 이 API들을 사용해서 application에서 보내려는 내용, 보내려는 주소를 넣으면 전송계층에서 받아서 보내게 된다.<br />▶socket은 일종의 “문”으로 생각할 수 있다. 프로세스에서 전송하려는 내용이 있으면 소켓을 사용해서 통신할 수 있다.<br />▶socket의 존재로 인해서 전송계층의 프로토콜을 구현할 필요 없이, socket의 함수들을 사용해서 손쉽게 데이터를 전송할 수 있다. |





#### 연결형 통신과 비연결형 통신

* 전송의 신뢰성: 데이터를 목적지에 문제없이 전달하는 것 
* 전송의 효율성: 데이터를 빠르게 전달하는 거
* 연결형 통신: 데이터 전송과정에서 수신노드와 발신노드가 계속해서 확인해가면서 전송하는 것
* 비연결형 통신: 데이터 전송과정에서 수신노드와 발신노드의 소통없이 바로 데이터를 전송하는 것
* 연결형 통신은 전송의 신뢰성을 보장하고 비연결형 통신은 전송의 효율성을 보장한다.

* 동영상과 같이 끊기는 것이 치명적인 경우 비연결형 통신을 사용한다.

* 전송계층의 연결형 통신 프로토콜에는 TCP가 사용되고, 비연결형 통신 프로토콜에는 UDP가 사용된다. 
* TCP: Transmission Control Protocol  /  UDP: User Datagram Protocol

​    

| 신뢰성 있는 전송이란?                                        |
| ------------------------------------------------------------ |
| ▶ 신뢰성 있는 전송은 **application layer가 보내고 받는 데이터가 무결성이게 보장하는 것**이지 데이터의 통신과정 전체에서 에러나 전송실패가 발생하지 않는 것을 의미하는게 아니다.<br />▶하위 계층에서는 에러나 전송실패가 발생할 수 있지만 **application layer에 데이터를 전달할 때는 온전한 형태로 전달하는 것**이 신뢰성 있는 전송이다. |





#### TCP

* 전송계층에서 TCP를 통해 데이터에 붙는 헤더는 **TCP 헤더**라고 한다.
* TCP 헤더와 데이터가 붙은 것을 **세그먼트** 라고 한다
* TCP에서는 데이터를 보낼 때마다 데이터에 고유 번호를 부여해서 전송하는데 이 번호를 **일련번호**라고 부른다. → 일련번호를 사용해서 데이터 패킷을 원본으로 복원한다.

​    



#### TCP의 헤더의 주요 기능_ 통신을 위한 Connection(연결)을 설정

* TCP 헤더에는 SYN,ACK 라는 Key가 있고 초기 상태의 값은 각각 0이다. 
  * SYN: 연결 요청  /  ACK: 연결요청에 대한 응답
* Connection 설정 과정: **3-way 핸드쉐이크**(3단계로 구성된 연결 형성)
  1. 연결 요청을 원하는 노드는 타겟 노드에게 TCP 헤더의 SYN값을 1로 설정해서 보낸다. ('연결요청합니다')
  2. 연결 요청을 받은 노드는 ACK, SYN의 값을 1로 설정해서 답신한다.('연결허락합니다' + '연결요청합니다')
  3. 답신을 받은 노드는 ACK를 1로 설정해서 답신한다. ('연결허락합니다')

​     



#### 버퍼

* 연결 설정 이후에 데이터 패킷을 교환하는데 이때 한번에 여러개의 패킷 교환이 이루어진다. 

* 여러 패킷이 동시에 교환되는데, 무한대까지 가능한 것은 아니고 각 노드의 하드웨어 성능에 따라 달라진다. 

* 교환 상태로 대기 중인 패킷들은 버퍼라는 곳에 저장된다.
* 교환 중인 데이터 크기가 버퍼를 초과하는 것을 오버플로우라고 한다.
* 버퍼 용량의 크기는 윈도우 크기라고 불리기도 한다.

​         



| ※ Window size가 무조건 크다고 좋은 것은 아니다.              |
| ------------------------------------------------------------ |
| ▶ Error가 발생하는 경우 해당 패킷부터 그 이후의 모든 패킷을 재전송한다. <br />▶window size가 8인 경우에 1번 패킷에 error가 발생하는 것과 window size가 80인 경우에 1번 패킷에 error가 발생하는 경우를 비교해서 생각해보면 된다.<br />▶ window size가 크면 재전송해야 하는 패킷의 수가 매우 커질 수 있기에 시스템의 안전성을 위협할 수 있다.<br />▶ window size는 네트워크의 혼잡이나 receive buffer가 수용할 수 있는 크기를 넘지 않는 선에서 최대한의 throughput(전송량)을 낼 수 있는 크기로 하는 것이 좋고, 시스템이 이러한 요인들을 고려해서 동적으로 window size를 조절하는 것이 좋다. |



​      



#### 포트번호

* 어플리케이션을 구분하기 위해 사용되는 주소

* 0~1023번 포트: 자주 사용되는 어플리케이션에 이미 할당되어 있는 포트 번호

  * 22번: SSH,  25번: SMTP,  53번: DNS,  80번: HPPT,  443번: HTTPS

* 1024번 포트: 할당되지는 않았지만 사용하지는 않는 포트

* 1025번 포트: 랜덤포트라고 불리며 클라이언트의 송신 포트로 사용된다

  ​     

  

#### UDP

* UDP 헤더가 붙은 데이터를 UDP 데이터 그램이라고 부른다. 

* 데이터를 여러 네트워크 장비(노드)에 일괄적으로 보내는 방식인 브로드캐스트는 바로 UDP를 통해서 이뤄진다.

  * TCP의 경우 데이터 전송시 일일히 확인하는 작업이 동반되기에 브로드캐스트에 적합하지 않다.

    